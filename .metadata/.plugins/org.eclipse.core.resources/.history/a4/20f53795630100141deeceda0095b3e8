import java.awt.Color;
import java.awt.image.BufferedImage;
import java.io.IOException;
import java.net.URI;
import java.net.URISyntaxException;
import java.nio.file.Path;
import java.nio.file.Paths;

import javax.imageio.ImageIO;

public class ImageConverter {


	private String convert(int intensity)
	{
		 if (intensity > 240) return " ";
		 else if (intensity >200 && intensity < 240) return ".";
		 else if (intensity >160 && intensity < 200) return "*";
		 else if (intensity >120 && intensity < 160) return "o";
		 else if (intensity >40 && intensity < 80) return "#";
		 else return "@";
	}

	public void exec(String string, int consoleSize) throws URISyntaxException, IOException {
		BufferedImage buffer = ImageIO.read(Paths.get(string).toFile());
		
		int width = buffer.getWidth();
		int height = buffer.getHeight();
		
		
		int blockSize = width / consoleSize;
		
		int widthBlocks = width / blockSize;
		int heigthBlocks = height / blockSize;
		
		StringBuilder picture = new StringBuilder();
		for (int i = 0; i < heigthBlocks; ++i) {
			for (int j = 0; j < widthBlocks; j++) {
				
				int intens = getIntenseFromBlock(i, j, blockSize, buffer);
				picture.append(convert(intens));
			}
			picture.append("\n");
		}
		
		System.out.println(picture.toString());
	}

	private int getIntenseFromBlock(int h, int w, int blockSize, BufferedImage buffer) {
		int heightBufferStart = h * blockSize;
		int widthBufferStart = w * blockSize;
		int accumulator = 0;
		Color c = null;
		for (int i = 0; i < blockSize; i++) {
			for (int j = 0; j < blockSize; j++) {
				 c = new Color(buffer.getRGB(widthBufferStart + j, heightBufferStart + i), false);
				accumulator += c.getBlue() + c.getGreen() + c.getRed();
			}
		}
		
		return accumulator / blockSize * blockSize;
	}
}
